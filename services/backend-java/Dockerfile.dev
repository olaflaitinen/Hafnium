# Development Dockerfile for Hafnium Backend
# Optimized for fast iteration with hot reload

FROM eclipse-temurin:21-jdk-alpine

WORKDIR /app

# Install required tools
RUN apk add --no-cache bash

# Copy Gradle wrapper and build files
COPY gradle gradle
COPY gradlew build.gradle settings.gradle gradle.properties ./
COPY common common

# Download dependencies (cached layer)
RUN ./gradlew dependencies --no-daemon

# Copy source code
COPY . .

# Build all services
RUN ./gradlew build -x test --no-daemon

# Default command runs identity-service
CMD ["./gradlew", ":identity-service:bootRun", "--no-daemon"]
